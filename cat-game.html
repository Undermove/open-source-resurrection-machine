<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Cat Hunter">
    <title>Cat Hunter Pro</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;800&family=Montserrat:wght@700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #09090b;
            --accent-color: oklch(0.7 0.2 150);
            --glass-bg: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.1);
            --font-main: 'Inter', -apple-system, sans-serif;
            --font-heading: 'Montserrat', sans-serif;
            --easing: cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body, html {
            width: 100%;
            height: 100%;
            overflow: hidden;
            background-color: var(--bg-color);
            font-family: var(--font-main);
            color: white;
            line-height: 1.5;
        }

        .world {
            position: fixed;
            inset: 0;
            z-index: 0;
            background-color: #3e2723;
            background-image: url('assets/table.png');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            overflow: hidden;
        }

        .world::after {
            content: '';
            position: absolute;
            inset: 0;
            background: radial-gradient(circle at 50% 50%, transparent, rgba(0, 0, 0, 0.5));
            pointer-events: none;
            z-index: 1;
        }

        .noise {
            position: absolute;
            inset: 0;
            opacity: 0.08;
            pointer-events: none;
            z-index: 2;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E");
        }

        canvas {
            display: block;
            touch-action: none;
            position: absolute;
            inset: 0;
            z-index: 5;
        }

        .hud {
            position: fixed;
            top: clamp(1rem, 4vw, 1.5rem);
            left: 1.5rem;
            right: 1.5rem;
            display: flex;
            gap: 0.75rem;
            pointer-events: none;
            z-index: 20;
        }

        .bento-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 0.75rem 1.25rem;
            border-radius: 1rem;
            display: flex;
            flex-direction: column;
            gap: 0.125rem;
        }

        .hud-value {
            font-size: 1.5rem;
            font-weight: 700;
            letter-spacing: -0.02em;
            color: var(--accent-color);
        }

        .hud-label {
            font-size: 0.625rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-weight: 500;
            opacity: 0.6;
        }

        #overlay {
            position: fixed;
            inset: 0;
            background: rgba(9, 9, 11, 0.4);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2.5rem;
            z-index: 100;
            transition: opacity 0.5s var(--easing), visibility 0.5s;
        }

        #overlay.hidden {
            opacity: 0;
            visibility: hidden;
        }

        h1 {
            font-family: var(--font-heading);
            font-size: clamp(2rem, 8vw, 4rem);
            margin-bottom: 3rem;
            letter-spacing: -0.04em;
            font-weight: 900;
            text-align: center;
            background: linear-gradient(to bottom, #fff, #999);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .modes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 1.25rem;
            width: 100%;
            max-width: 900px;
        }

        .mode-option {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 2rem 1.5rem;
            border-radius: 1.75rem;
            cursor: pointer;
            transition: all 0.3s var(--easing);
            text-align: left;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .mode-option:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-6px);
            border-color: var(--accent-color);
        }

        .mode-option h3 { 
            font-family: var(--font-heading);
            font-size: 1.25rem; 
            font-weight: 700; 
            letter-spacing: -0.01em;
        }
        
        .mode-option p { 
            font-size: 0.875rem; 
            opacity: 0.5; 
            line-height: 1.5;
        }

        #gameOver {
            position: fixed;
            inset: 0;
            z-index: 110;
            background: rgba(9, 9, 11, 0.9);
            backdrop-filter: blur(40px);
            -webkit-backdrop-filter: blur(40px);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            visibility: hidden;
            opacity: 0;
            transition: 0.5s var(--easing);
        }

        #gameOver.active { visibility: visible; opacity: 1; }

        .restart-btn {
            margin-top: 2.5rem;
            background: white;
            color: black;
            border: none;
            padding: 1.125rem 3rem;
            border-radius: 100px;
            font-weight: 700;
            font-size: 1rem;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .restart-btn:hover { transform: scale(1.05); }
    </style>
</head>
<body>
    <div id="overlay">
        <h1>CAT HUNTER PRO</h1>
        <div class="modes-grid">
            <div class="mode-option" onclick="startGame('infinite')">
                <h3>‚ôæÔ∏è Infinite</h3>
                <p>Relaxed hunt. No limits, just pure enjoyment for your feline friend.</p>
            </div>
            <div class="mode-option" onclick="startGame('time')">
                <h3>‚è±Ô∏è 5 Minutes</h3>
                <p>Time Trial. How many can they catch before the timer runs out?</p>
            </div>
            <div class="mode-option" onclick="startGame('target')">
                <h3>üéØ 50 Flies</h3>
                <p>Objective Hunt. The game ends once 50 flies are caught.</p>
            </div>
        </div>
    </div>

    <div id="gameOver">
        <h2 style="font-family: var(--font-heading); letter-spacing: -0.02em;">MISSION COMPLETE</h2>
        <div class="hud-value" style="font-size: 5rem; margin: 1.5rem 0;" id="finalScore">0</div>
        <p class="hud-label">Flies caught</p>
        <button class="restart-btn" onclick="location.reload()">MAIN MENU</button>
    </div>

    <div class="world">
        <div class="noise"></div>
    </div>

    <div class="hud" id="hud" style="display: none;">
        <div class="bento-card">
            <span class="hud-label">Score</span>
            <span class="hud-value" id="score">0</span>
        </div>
        <div class="bento-card" id="timerCard" style="display: none;">
            <span class="hud-label" id="timerLabel">Time</span>
            <span class="hud-value" id="timerValue">05:00</span>
        </div>
    </div>

    <canvas id="gameCanvas"></canvas>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreEl = document.getElementById('score');
        const timerValueEl = document.getElementById('timerValue');
        const timerCard = document.getElementById('timerCard');
        const timerLabel = document.getElementById('timerLabel');
        const overlay = document.getElementById('overlay');
        const gameOverEl = document.getElementById('gameOver');
        const finalScoreEl = document.getElementById('finalScore');
        const hud = document.getElementById('hud');

        const flyImg = new Image();
        let processedFlyImg = null;
        flyImg.onload = () => {
            const tempCanvas = document.createElement('canvas');
            const tCtx = tempCanvas.getContext('2d');
            tempCanvas.width = flyImg.width;
            tempCanvas.height = flyImg.height;
            tCtx.drawImage(flyImg, 0, 0);
            const imgData = tCtx.getImageData(0, 0, tempCanvas.width, tempCanvas.height);
            const data = imgData.data;
            for (let i = 0; i < data.length; i += 4) {
                // –ï—Å–ª–∏ –ø–∏–∫—Å–µ–ª—å –±–µ–ª—ã–π –∏–ª–∏ –æ—á–µ–Ω—å —Å–≤–µ—Ç–ª—ã–π, –¥–µ–ª–∞–µ–º –µ–≥–æ –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–º
                if (data[i] > 200 && data[i+1] > 200 && data[i+2] > 200) {
                    data[i+3] = 0;
                }
            }
            tCtx.putImageData(imgData, 0, 0);
            processedFlyImg = new Image();
            processedFlyImg.src = tempCanvas.toDataURL();
        };
        flyImg.src = 'assets/fly.png';

        const slapSound = new Audio('assets/human_hand_slap_around_face.mp3');

        let score = 0;
        let flies = [];
        let particles = [];
        let gameActive = false;
        let currentMode = 'infinite';
        let timeLeft = 300;
        let lastTime = 0;
        const flyCount = 6;

        function playSlapSound() {
            slapSound.currentTime = 0;
            slapSound.play().catch(() => {});
        }

        class Fly {
            constructor() {
                this.init();
            }

            init() {
                this.x = Math.random() * canvas.width;
                this.y = Math.random() * canvas.height;
                this.size = 70 + Math.random() * 30;
                this.angle = Math.random() * Math.PI * 2;
                this.speed = 2.0 + Math.random() * 2.0; 
                this.turnSpeed = (Math.random() - 0.5) * 0.15;
            }

            update() {
                if (!gameActive) return;
                this.angle += this.turnSpeed;
                if (Math.random() < 0.05) this.turnSpeed = (Math.random() - 0.5) * 0.2;
                
                this.x += Math.cos(this.angle) * this.speed;
                this.y += Math.sin(this.angle) * this.speed;
                
                if (this.x < -100) this.x = canvas.width + 100;
                if (this.x > canvas.width + 100) this.x = -100;
                if (this.y < -100) this.y = canvas.height + 100;
                if (this.y > canvas.height + 100) this.y = -100;
            }

            draw() {
                ctx.save();
                ctx.translate(this.x, this.y);
                ctx.rotate(this.angle + Math.PI / 2);
                
                // –†–∏—Å—É–µ–º –º—É—Ö—É (–∏—Å–ø–æ–ª—å–∑—É–µ–º –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é –±–µ–∑ —Ñ–æ–Ω–∞, –µ—Å–ª–∏ –≥–æ—Ç–æ–≤–∞)
                const imgToDraw = processedFlyImg || flyImg;
                ctx.drawImage(
                    imgToDraw, 
                    -this.size/2, -this.size/2, this.size, this.size
                );
                ctx.restore();
            }

            explode() {
                score++; scoreEl.innerText = score;
                playSlapSound();
                for (let i = 0; i < 15; i++) particles.push(new Particle(this.x, this.y));
                if (currentMode === 'target' && score >= 50) endGame("MISSION COMPLETE");
                this.init();
            }
        }

        class Particle {
            constructor(x, y) {
                this.x = x; this.y = y;
                this.vx = (Math.random() - 0.5) * 12; this.vy = (Math.random() - 0.5) * 12;
                this.life = 1.0; this.size = Math.random() * 4 + 2;
                this.color = Math.random() > 0.5 ? '#111' : '#333';
            }
            update() { 
                this.x += this.vx; this.y += this.vy; 
                this.vx *= 0.95; this.vy *= 0.95; 
                this.life -= 0.03; 
            }
            draw() {
                ctx.globalAlpha = this.life; ctx.fillStyle = this.color;
                ctx.beginPath(); ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2); ctx.fill();
                ctx.globalAlpha = 1.0;
            }
        }

        function startGame(mode) {
            // –ó–∞–ø—Ä–æ—Å –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞
            if (document.documentElement.requestFullscreen) {
                document.documentElement.requestFullscreen().catch(() => {});
            } else if (document.documentElement.webkitRequestFullscreen) {
                document.documentElement.webkitRequestFullscreen();
            } else if (document.documentElement.msRequestFullscreen) {
                document.documentElement.msRequestFullscreen();
            }

            slapSound.play().catch(() => {});
            currentMode = mode; gameActive = true;
            overlay.classList.add('hidden'); hud.style.display = 'flex';
            if (mode === 'time') { timeLeft = 300; timerCard.style.display = 'flex'; timerLabel.innerText = "Time"; }
            else if (mode === 'target') { timerCard.style.display = 'flex'; timerLabel.innerText = "Target"; timerValueEl.innerText = `0/50`; }
            for (let i = 0; i < flyCount; i++) flies.push(new Fly());
            requestAnimationFrame(animate);
        }

        function endGame(title) { gameActive = false; finalScoreEl.innerText = score; gameOverEl.classList.add('active'); }
        function formatTime(s) { const m = Math.floor(s / 60); const rs = Math.floor(s % 60); return `${m.toString().padStart(2, '0')}:${rs.toString().padStart(2, '0')}`; }

        function animate(timestamp) {
            if (!gameActive && particles.length === 0) return;
            if (currentMode === 'time' && gameActive) {
                if (!lastTime) lastTime = timestamp;
                const delta = (timestamp - lastTime) / 1000;
                lastTime = timestamp; timeLeft -= delta;
                timerValueEl.innerText = formatTime(Math.max(0, timeLeft));
                if (timeLeft <= 0) endGame("TIME'S UP");
            }
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            flies.forEach(f => { f.update(); f.draw(); });
            particles = particles.filter(p => p.life > 0);
            particles.forEach(p => { p.update(); p.draw(); });
            if (gameActive || particles.length > 0) requestAnimationFrame(animate);
        }

        function handleInteraction(e) {
            if (!gameActive) return;
            const touches = e.touches || [e];
            const rect = canvas.getBoundingClientRect();
            for (let i = 0; i < touches.length; i++) {
                const t = touches[i];
                const x = (t.clientX || t.pageX) - rect.left;
                const y = (t.clientY || t.pageY) - rect.top;
                flies.forEach(fly => { 
                    if (Math.hypot(fly.x - x, fly.y - y) < fly.size * 0.6) fly.explode(); 
                });
            }
            if (e.type === 'touchstart') e.preventDefault();
        }

        function resize() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
        window.addEventListener('resize', resize);
        canvas.addEventListener('mousedown', handleInteraction);
        canvas.addEventListener('touchstart', handleInteraction, {passive: false});
        resize();
    </script>
</body>
</html>
